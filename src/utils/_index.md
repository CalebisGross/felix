# Utils Module

## Purpose
Common utility functions providing markdown formatting, report generation, and helper functions for workflow output presentation.

## Key Files

### [markdown_formatter.py](markdown_formatter.py)
Professional markdown output formatting for synthesis results.

**Key Functions**:

#### `format_synthesis_markdown(synthesis_text: str, confidence: float) -> str`
Basic markdown formatting for synthesis output.
- **Input**: Synthesis text and confidence score
- **Output**: Formatted markdown with headers and metadata
- **Format**:
  ```markdown
  # Synthesis Result

  **Confidence**: 0.85

  {synthesis_text}
  ```

#### `format_synthesis_markdown_detailed(synthesis_text: str, confidence: float, agent_metrics: dict, workflow_stats: dict) -> str`
Comprehensive markdown report with full metrics.
- **Input**: Synthesis text, confidence, agent metrics, workflow statistics
- **Output**: Detailed markdown report with performance data
- **Sections**:
  1. **Overview**: Task summary and confidence
  2. **Synthesis**: Main result text
  3. **Agent Metrics**: Per-agent performance breakdown
     - Agent ID and role
     - Tokens used
     - Execution time
     - Contribution score
  4. **Workflow Statistics**: System-level metrics
     - Total agents spawned
     - Total tokens consumed
     - Processing time
     - Average agent latency
     - Confidence progression
  5. **Metadata**: Timestamp, version, helix parameters

#### `save_markdown_to_file(markdown_content: str, filepath: str) -> bool`
Saves formatted markdown to file.
- **Input**: Markdown content and target file path
- **Output**: Success boolean
- **Features**: Creates directories if needed, handles errors gracefully

## Output Examples

### Basic Format
```markdown
# Felix Workflow Result

**Task**: Analyze quantum computing trends
**Confidence**: 0.87
**Timestamp**: 2025-01-15 14:30:45

## Synthesis

Quantum computing has seen significant advances in error correction...

---
Generated by Felix Multi-Agent Framework
```

### Detailed Format
```markdown
# Felix Workflow Analysis

## Overview
- **Task**: Analyze quantum computing trends
- **Confidence**: 0.87
- **Status**: SUCCESS
- **Completed**: 2025-01-15 14:30:45

## Synthesis

Quantum computing has seen significant advances in error correction...

## Agent Metrics

### Research Agent (research_001)
- **Role**: Research
- **Tokens Used**: 1,842
- **Execution Time**: 12.5s
- **Contribution Score**: 0.92

### Analysis Agent (analysis_001)
- **Role**: Analysis
- **Tokens Used**: 1,654
- **Execution Time**: 10.8s
- **Contribution Score**: 0.88

### Critic Agent (critic_001)
- **Role**: Critic
- **Tokens Used**: 1,234
- **Execution Time**: 8.3s
- **Contribution Score**: 0.85

## Workflow Statistics

- **Total Agents**: 3
- **Total Tokens**: 4,730
- **Processing Time**: 31.6s
- **Average Latency**: 10.5s per agent
- **Confidence Progression**: 0.45 → 0.72 → 0.87

## Configuration

- **Helix**: Top radius 3.0, Bottom radius 0.5, Height 8.0, Turns 2
- **Spawning Threshold**: 0.80
- **Max Agents**: 10
- **Token Budget**: 2,048 per agent

---
Generated by Felix Multi-Agent Framework v1.0
```

## Usage Example

```python
from src.utils.markdown_formatter import (
    format_synthesis_markdown,
    format_synthesis_markdown_detailed,
    save_markdown_to_file
)

# Basic formatting
markdown = format_synthesis_markdown(
    synthesis_text="Analysis complete...",
    confidence=0.87
)

# Detailed formatting with metrics
agent_metrics = {
    "research_001": {
        "role": "Research",
        "tokens": 1842,
        "time": 12.5,
        "contribution": 0.92
    },
    # ...more agents
}

workflow_stats = {
    "total_agents": 3,
    "total_tokens": 4730,
    "processing_time": 31.6,
    "avg_latency": 10.5
}

detailed_markdown = format_synthesis_markdown_detailed(
    synthesis_text="Analysis complete...",
    confidence=0.87,
    agent_metrics=agent_metrics,
    workflow_stats=workflow_stats
)

# Save to file
save_markdown_to_file(detailed_markdown, "results/analysis_2025-01-15.md")
```

## Key Concepts

### Professional Formatting
- Consistent header hierarchy
- Clear section separation
- Readable metrics presentation
- Proper markdown syntax

### Metrics Display
- Human-readable numbers (comma separators)
- Time formatting (seconds with decimals)
- Confidence as percentage or decimal
- Color-coded status (when rendered)

### Report Sections
1. **Overview**: Quick summary
2. **Synthesis**: Main content
3. **Metrics**: Performance data
4. **Configuration**: System parameters
5. **Footer**: Metadata and branding

### File Management
- Auto-create parent directories
- Handle file permissions errors
- Validate file paths
- Timestamp-based naming conventions

## Integration Points

Used by:
- [Workflows tab](../gui/workflows.py): Export synthesis results
- [WorkflowHistory](../memory/workflow_history.py): Store formatted results
- CLI output: Display results in terminal
- Report generation: Batch workflow summaries

## Related Modules
- [workflows/](../workflows/) - Generates synthesis text formatted by utils
- [gui/](../gui/) - Workflows tab uses formatting for export
- [memory/](../memory/) - Stores formatted results
- [communication/](../communication/) - SynthesisEngine output formatted by utils
